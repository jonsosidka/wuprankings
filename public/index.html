<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WUP Power Rankings</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
      :root {
        --bg: #0b0f17;
        --panel: #121826;
        --accent: #00e5ff;
        --accent2: #ff3d71;
        --text: #e8eef7;
        --muted: #8590a2;
        --gold: #ffd700;
      }
      * { box-sizing: border-box; }
      body { margin: 0; background: radial-gradient(circle at 20% 10%, #10182a, #080c13); color: var(--text); font-family: Roboto, system-ui, -apple-system, Segoe UI, Helvetica, Arial, sans-serif; }
      header { padding: 24px 16px; text-align: center; border-bottom: 1px solid #1e2740; background: linear-gradient(180deg, rgba(18,24,38,0.9), rgba(18,24,38,0.6)); backdrop-filter: blur(6px); position: sticky; top: 0; z-index: 10; }
      h1 { margin: 0; font-family: Orbitron, monospace; letter-spacing: 2px; text-transform: uppercase; font-weight: 900; font-size: 28px; }
      #controls { display: none; }
      main { max-width: 980px; margin: 24px auto; padding: 0 16px; }
      .board { background: linear-gradient(180deg, #0f1728, #0b101a); border: 1px solid #1c2440; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.5), inset 0 0 40px rgba(0, 229, 255, 0.05); overflow: hidden; }
      .row { display: grid; grid-template-columns: 64px 1fr 140px; align-items: center; padding: 16px; border-bottom: 1px solid #1a223c; position: relative; }
      .row:nth-child(odd) { background: rgba(255,255,255,0.01); }
      .rank { font-family: Orbitron, monospace; font-weight: 900; font-size: 26px; color: var(--gold); text-shadow: 0 0 15px rgba(255,215,0,0.3); }
      .team { font-size: 24px; font-weight: 900; letter-spacing: 1.2px; text-transform: uppercase; color: var(--accent); text-shadow: 0 0 6px rgba(0,229,255,0.8), 0 0 14px rgba(0,229,255,0.5), 0 0 28px rgba(0,229,255,0.25); font-family: Orbitron, monospace; }
      .score { font-family: Orbitron, monospace; font-weight: 700; font-size: 22px; color: var(--accent); text-align: right; }
      .players { color: var(--muted); font-size: 12px; margin-top: 6px; line-height: 1.35; }
      .marquee { position: absolute; inset: 0; pointer-events: none; background: radial-gradient(120px 30px at -40px 50%, rgba(0,229,255,0.09), transparent), radial-gradient(120px 30px at calc(100% + 40px) 50%, rgba(255,61,113,0.09), transparent); opacity: 0; transition: opacity .3s ease; }
      .row:hover .marquee { opacity: 1; }
      footer { text-align: center; color: var(--muted); padding: 20px 0 40px; font-size: 12px; }
      @media (max-width: 560px) {
        .row { grid-template-columns: 48px 1fr 100px; padding: 12px; }
        .rank { font-size: 22px; }
        .team { font-size: 16px; }
        .score { font-size: 18px; }
        .players { display: none; }
      }
      .details { position: fixed; top: 88px; right: 0; width: 50vw; max-width: 640px; height: calc(100% - 88px); background: linear-gradient(180deg, #0f1728, #0b101a); border-left: 1px solid #1c2440; box-shadow: -10px 0 30px rgba(0,0,0,0.4), inset 0 0 40px rgba(0, 229, 255, 0.05); transform: translateX(100%); transition: transform .35s ease; overflow: auto; padding: 16px; }
      body.show-details .details { transform: translateX(0); }
      .details .details-header { display: grid; grid-template-columns: 80px 1fr 100px; align-items: center; gap: 8px; padding-bottom: 12px; border-bottom: 1px solid #1a223c; }
      .details .back { background: #0e1422; border: 1px solid #243252; color: var(--text); padding: 8px 12px; border-radius: 8px; cursor: pointer; }
      .details .title { font-family: Orbitron, monospace; font-weight: 800; letter-spacing: 1px; }
      .details .total { text-align: right; color: var(--accent); font-family: Orbitron, monospace; font-weight: 700; }
      .details .columns { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
      .details .col-title { font-weight: 700; color: var(--muted); margin-bottom: 8px; }
      .details .player { display: grid; grid-template-columns: 56px 1fr 72px; gap: 8px; padding: 8px 0; border-bottom: 1px solid #111828; }
      body.show-details .board { transform: translateX(-8%); transition: transform .35s ease; }
    </style>
  </head>
  <body>
    <header>
      <h1>WUP Fantasy Power Rankings</h1>
      <div id="controls"></div>
    </header>
    <main>
      <div class="board" id="board"></div>
      <div id="details" class="details"></div>
    </main>
    <footer>
      Powered by Fatals.net
    </footer>
    <script>
      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      async function fetchRankings() {
        const leagueId = getQueryParam('leagueId');
        const qs = leagueId ? `?leagueId=${encodeURIComponent(leagueId)}` : '';
        const res = await fetch(`/api/rankings${qs}`);
        if (!res.ok) throw new Error('Failed to load rankings');
        return res.json();
      }

      function formatScore(n) {
        return (Math.round(n * 10) / 10).toFixed(1);
      }

      function renderBoard(data) {
        const board = document.getElementById('board');
        board.innerHTML = '';
        data.forEach((item) => {
          const row = document.createElement('div');
          row.className = 'row';
          row.innerHTML = `
            <div class="rank">${item.rank}</div>
            <div>
              <div class="team">${item.teamName}</div>
            </div>
            <div class="score">${formatScore(item.totalProjected)}</div>
            <div class="marquee"></div>
          `;
          row.addEventListener('click', () => openDetails(item));
          board.appendChild(row);
        });
      }

      function openDetails(team) {
        const details = document.getElementById('details');
        const starters = team.players.filter(p => p.isStarter).sort((a,b)=> b.projected - a.projected);
        const bench = team.players.filter(p => !p.isStarter).sort((a,b)=> b.projected - a.projected);
        details.innerHTML = `
          <div class="details-header">
            <button class="back" id="backBtn">â—€ Back</button>
            <div class="title">${team.teamName}</div>
            <div class="total">${formatScore(team.totalProjected)}</div>
          </div>
          <div class="columns">
            <div class="col">
              <div class="col-title">Starters</div>
              ${starters.map(p => `<div class="player"><span>${p.position}</span><span>${p.name}</span><span>${formatScore(p.projected)}</span></div>`).join('')}
            </div>
            <div class="col">
              <div class="col-title">Bench</div>
              ${bench.map(p => `<div class="player"><span>${p.position}</span><span>${p.name}</span><span>${formatScore(p.projected)}</span></div>`).join('')}
            </div>
          </div>
        `;
        document.body.classList.add('show-details');
        document.getElementById('backBtn').addEventListener('click', closeDetails);
      }

      function closeDetails() {
        document.body.classList.remove('show-details');
      }

      async function load() {
        try {
          const data = await fetchRankings();
          renderBoard(data);
        } catch (e) {
          alert(e.message);
        }
      }

      // Auto-load
      load();
    </script>
  </body>
</html>
